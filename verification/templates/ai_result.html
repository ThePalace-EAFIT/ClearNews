{% extends 'base.html' %}
{% load i18n %}

{% block content %}
  <div class="card text-white bg-dark mb-4">
    <div class="card-body">
      <h4 class="card-title">{% trans "Verification result" %}</h4>
      {% if url %}
      <p><strong>{% trans "Link evaluated:" %}</strong><br>
        <a href="{{ url }}" class="text-info" target="_blank">{{ url }}</a>
      </p>
      {% endif %}
      <p><strong>{% trans "AI result:" %}</strong></p>
      <div id="ai-result" class="bg-dark text-white p-3 rounded mb-2" style="white-space: pre-wrap;">
        {{ result }}
        <div class="alert alert-warning mt-1" role="alert">
          <strong>{% trans "Disclaimer:" %}</strong> {% trans "This result was generated by AI and may not be 100% accurate. Always double-check with official sources." %}
        </div>       
      </div>
      <button class="btn btn-outline-light btn-sm mb-3" onclick="copyToClipboard()">
        <i class="bi bi-clipboard"></i> {% trans "Copy result" %}
      </button>
      <span id="copy-confirmation" class="text-success" style="display: none; margin-left: 10px;">{% trans "Copied!" %}</span>      
    </div>
  </div>
  
  {% if url %}
  <div class="card text-white bg-secondary mb-4">
    <div class="card-body">
      <h5 class="card-title">{% trans "Information extracted from the link" %}</h5>
      <p><strong>{% trans "Title:" %}</strong> {{ title }}</p>
      <p><strong>{% trans "Author:" %}</strong> {{ author }}</p>
      <p><strong>{% trans "Date of publication:" %}</strong> {{ date }}</p>
      <p><strong>{% trans "Text:" %}</strong></p>
      <div id="article-preview" class="mb-2">
        {{ text|truncatechars:100 }}...
      </div>
  
      <div id="article-full" style="display: none;">
        <p>{{ text }}</p>
      </div>
  
      <button class="btn btn-outline-light btn-sm" id="toggle-text">{% trans "See more..." %}</button>
    </div>
  </div>
  {% endif %}
  
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const preview = document.getElementById("article-preview");
      const full = document.getElementById("article-full");
      const toggleBtn = document.getElementById("toggle-text");
  
      toggleBtn.addEventListener("click", function () {
        if (full.style.display === "none") {
          full.style.display = "block";
          preview.style.display = "none";
          toggleBtn.textContent = "See less...";
        } else {
          full.style.display = "none";
          preview.style.display = "block";
          toggleBtn.textContent = "See more...";
        }
      });
    });

    function copyToClipboard() {
      const text = document.getElementById("ai-result").innerText;
      navigator.clipboard.writeText(text).then(function() {
        const confirmation = document.getElementById("copy-confirmation");
        confirmation.style.display = "inline";
        setTimeout(() => confirmation.style.display = "none", 2000);
      }, function(err) {
        console.error("Error copying text: ", err);
      });
    }
  </script>

{% endblock %}
